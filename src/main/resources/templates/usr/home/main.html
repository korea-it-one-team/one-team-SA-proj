<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{common/head :: head}">
    <title>MAIN</title>
</head>
<style>
    .main-container-section-1 {
        overflow: hidden;
        background: url('/assets/home-main-bg.png') no-repeat center;
        background-size: cover;
    }

    .main-container-section-1,
    .main-container-section-1 * {
        box-sizing: border-box;
    }

    input,
    select,
    textarea,
    button {
        outline: 0;
    }

    body {
        background-color: #1e1e1e;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .transparent-black {
        background: rgba(0, 0, 0, 0.4);
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
    }

    .main-container-section-1 {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        flex-wrap: nowrap;
        position: relative;
        width: calc(1440 * var(--rpx-vw)); /* 가로 기준 비율 */
        height: calc(1024 * var(--rpx-vh)); /* 세로 기준 비율 */
        margin: 0 auto;
        overflow: hidden;
    }

    .transparent-flex-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        align-self: stretch;
        flex-wrap: nowrap;
        flex-grow: 1;
        flex-shrink: 1;
        flex-basis: 0;
        gap: calc(10 * var(--rpx-vw));
        position: relative;
        min-width: 0;
        min-height: 0;
        padding: calc(10 * var(--rpx-vh)) calc(10 * var(--rpx-vw));
        background: rgba(0, 0, 0, 0);
        z-index: 11;
    }

    .banners {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex-wrap: nowrap;
        flex-shrink: 1;
        gap: calc(10 * var(--rpx-vw));
        position: absolute;
        width: calc(1440 * var(--rpx-vw));
        top: 0;
        bottom: 0;
        left: 50%;
        transform: translate(-50%, 0);
        z-index: 12;
    }

    .banner-container {
        display: flex;
        align-items: center;
        justify-content: center;
        align-self: stretch;
        flex-wrap: nowrap;
        flex-grow: 1;
        flex-shrink: 1;
        flex-basis: 0;
        gap: calc(53 * var(--rpx-vw));
        position: relative;
        min-width: 0;
        min-height: 0;
        z-index: 13;
    }

    .left-rectangle {
        align-self: stretch;
        flex-grow: 1;
        flex-shrink: 0;
        flex-basis: 0;
        position: relative;
        background: #cdf256;
        z-index: 14;
        max-width: calc(72 * var(--rpx-vw));
        box-shadow: calc(8 * var(--rpx-vw)) 0 0 0 #7a9d0b;
    }

    .banner-text {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        flex-shrink: 1;
        position: relative;
        width: calc(987 * var(--rpx-vw));
        color: #cdf256;
        font-family: Audiowide, var(--default-font-family);
        font-size: calc(86 * var(--rpx-vw));
        font-weight: 400;
        text-align: left;
        text-overflow: ellipsis;
        z-index: 15;
        overflow: hidden;
        text-shadow: calc(4 * var(--rpx-vw)) calc(4 * var(--rpx-vw)) 0 #7a9d0b;
        top: calc(70 * var(--rpx-vh));
    }

    .main-container-section-2,
    .main-container-section-2 * {
        box-sizing: border-box;
    }

    input,
    select,
    textarea,
    button {
        outline: 0;
    }

    .main-container-section-2 {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: nowrap;
        gap: calc(45 * var(--rpx-vw));
        position: relative;
        width: calc(1440 * var(--rpx-vw));
        height: calc(1024 * var(--rpx-vh));
        margin: 0 auto;
        padding: 0 calc(60 * var(--rpx-vw)) 0 calc(60 * var(--rpx-vw));
        background: #1e1e1e;
        overflow: hidden;
    }

    .news-contents {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: nowrap;
        flex-grow: 1;
        flex-shrink: 0;
        flex-basis: 0;
        position: relative;
        min-width: 0;
        max-width: calc(525 * var(--rpx-vw));
    }

    .shadow-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex-wrap: nowrap;
        flex-grow: 1;
        flex-shrink: 0;
        flex-basis: 0;
        position: relative;
        background: #ffffff;
        z-index: 1;
        border-radius: calc(25 * var(--rpx-vw));
        box-shadow: calc(8 * var(--rpx-vw)) calc(8 * var(--rpx-vw)) 0 0 #7a9d0b;
    }

    .news-box-title {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        align-self: stretch;
        flex-wrap: nowrap;
        flex-shrink: 0;
        position: relative;
        padding: calc(15 * var(--rpx-vh)) 0 calc(15 * var(--rpx-vh)) 0;
        background: #cdf256;
        border: none;
        z-index: 2;
        border-radius: calc(25 * var(--rpx-vw)) calc(25 * var(--rpx-vw)) 0 0;
    }

    .news-box-text {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        flex-basis: auto;
        position: relative;
        width: calc(178 * var(--rpx-vw));
        height: calc(36 * var(--rpx-vh));
        color: #000000;
        font-family: NEXON Football Gothic B, var(--default-font-family);
        font-size: calc(24 * var(--rpx-vw));
        font-weight: 700;
        text-align: center;
        text-overflow: ellipsis;
        white-space: nowrap;
        z-index: 3;
        overflow: hidden;
    }

    .news-box-lists {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start; /* Center에서 위쪽으로 시작하도록 변경 */
        align-self: stretch;
        flex-wrap: nowrap;
        flex-shrink: 0;
        position: relative;
        height: calc(645 * var(--rpx-vh));
        background-size: cover;
        z-index: 4;
        overflow-y: auto; /* 추가: 스크롤 활성화 */
        padding: calc(10 * var(--rpx-vh)); /* 내부 여백 추가 */
    }

    .news-list-container {
        font-family: "Noto Sans KR";
        font-weight: 400;
        color: #1e1e1e;
        width: 100%; /* 너비를 news-box-lists에 맞추기 */
        max-height: calc(600 * var(--rpx-vh)); /* 전체 높이를 제한하여 스크롤이 news-box-lists 내에 머물도록 설정 */
        overflow-y: scroll; /* 추가: 스크롤을 컨테이너에 추가 */
        padding-right: calc(5 * var(--rpx-vw)); /* 스크롤과 텍스트 사이 간격 */
    }

    .news-list-container::-webkit-scrollbar {
        width: 12px !important;
        height: 12px !important;
    }

    .news-list-container::-webkit-scrollbar-thumb {
        background-color: #4caf50 !important;
        border-radius: 10px !important;
        border: 3px solid #f1f1f1 !important;
    }

    .news-list-container::-webkit-scrollbar-corner {
        background: #f1f1f1 !important;
    }

    /* 스피너 CSS */
    /* 스피너 부모 요소 */
    #loadingSpinner {
        display: flex;
        justify-content: center;
        align-items: center;
        position: absolute;
        top: 50%; /* 세로 가운데 정렬 */
        left: 50%; /* 가로 가운데 정렬 */
        transform: translate(-50%, -50%);
        z-index: 5; /* 다른 요소들보다 위에 표시 */
        pointer-events: none; /* 로딩 중 다른 요소에 영향을 주지 않도록 설정 */
    }

    .spinner {
        border: calc(8 * var(--rpx-vw)) solid #4caf50;
        border-top: calc(8 * var(--rpx-vw)) solid transparent;
        border-radius: 50%;
        width: calc(80 * var(--rpx-vw));
        height: calc(80 * var(--rpx-vw));
        animation: spin 1s linear infinite;
    }

    /* 스피너 애니메이션 */
    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }

    .total-news-btn, .total-schedule-btn {
        color: #7a9d0b;
        font-family: 'NEXON Football Gothic B';
        font-size: calc(16 * var(--rpx-vw));
    }

    .total-news, .total-schedule {
        margin-bottom: calc(13 * var(--rpx-vh));
    }

    .schedule-contents {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: nowrap;
        flex-grow: 1;
        flex-shrink: 0;
        flex-basis: 0;
        position: relative;
        min-width: 0;
        z-index: 5;
    }

    .shadow-box-1 {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex-wrap: nowrap;
        flex-grow: 1;
        flex-shrink: 0;
        flex-basis: 0;
        position: relative;
        background: #ffffff;
        z-index: 6;
        border-radius: calc(25 * var(--rpx-vw));
        box-shadow: calc(8 * var(--rpx-vw)) calc(8 * var(--rpx-vw)) 0 0 #7a9d0b;
    }

    .schedule-box-title {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        align-self: stretch;
        flex-wrap: nowrap;
        flex-shrink: 0;
        position: relative;
        padding: calc(15 * var(--rpx-vh)) 0 calc(15 * var(--rpx-vh)) 0;
        background: #cdf256;
        border: none;
        z-index: 2;
        border-radius: calc(25 * var(--rpx-vw)) calc(25 * var(--rpx-vw)) 0 0;
    }

    .schedule-box-text {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        flex-basis: auto;
        position: relative;
        width: calc(178 * var(--rpx-vw));
        height: calc(36 * var(--rpx-vh));
        color: #000000;
        font-family: NEXON Football Gothic B, var(--default-font-family);
        font-size: calc(24 * var(--rpx-vw));
        font-weight: 700;
        text-align: center;
        text-overflow: ellipsis;
        white-space: nowrap;
        z-index: 3;
        overflow: hidden;
    }

    .schedule-box-lists {
        display: flex;
        flex-direction: column; /* 수직으로 정렬 */
        align-items: center;
        justify-content: flex-start; /* 상단 정렬 */
        align-self: stretch;
        flex-wrap: nowrap;
        flex-shrink: 0;
        position: relative;
        height: calc(645 * var(--rpx-vh)); /* 전체 높이 */
        background-size: cover;
        z-index: 9;
        overflow: hidden; /* 전체 상자에서 스크롤은 gameSchedule-list-container에만 발생 */
        padding: 0 calc(8 * var(--rpx-vw)) calc(10 * var(--rpx-vw)) calc(8 * var(--rpx-vw));
    }

    .total-schedule {
        width: 100%; /* 상단 요소가 전체 너비를 차지하도록 설정 */
        text-align: center;
        padding-top: calc(10 * var(--rpx-vh));
        padding-bottom: calc(5 * var(--rpx-vh)); /* 하단 여백 추가 */
        background-color: #ffffff; /* 상단 배경 추가 */
        z-index: 2; /* 스크롤 컨텐츠와 겹치지 않도록 설정 */
    }

    .gameSchedule-list-container {
        flex: 1; /* 남은 공간을 모두 차지 */
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        margin: 0 auto;
        max-height: calc(600 * var(--rpx-vh)); /* 전체 높이를 제한하여 스크롤이 news-box-lists 내에 머물도록 설정 */
        overflow-y: scroll; /* 추가: 스크롤을 컨테이너에 추가 */
        padding: calc(10 * var(--rpx-vw));
    }

    .gameSchedule-list-container::-webkit-scrollbar {
        width: 12px !important;
        height: 12px !important;
    }

    .gameSchedule-list-container::-webkit-scrollbar-thumb {
        background-color: #4caf50 !important;
        border-radius: 10px !important;
        border: 3px solid #f1f1f1 !important;
    }

    .gameSchedule-list-container::-webkit-scrollbar-corner {
        background: #f1f1f1 !important;
    }

    #gameSchedule-list {
        width: 100%;
    }

    .league-container {
        background-color: #252525;
        border-radius: calc(8 * var(--rpx-vw));
        padding: calc(15 * var(--rpx-vw)) calc(15 * var(--rpx-vw)) calc(10 * var(--rpx-vw)) calc(15 * var(--rpx-vw));
        margin-bottom: calc(20 * var(--rpx-vh));
        box-shadow: calc(0 * var(--rpx-vw)) calc(4 * var(--rpx-vw)) calc(8 * var(--rpx-vw)) rgba(0, 0, 0, 0.2);
    }

    .league-header {
        font-size: calc(20 * var(--rpx-vw));
        font-weight: bold;
        color: #ffffff;
        margin-bottom: calc(10 * var(--rpx-vw));
        border-bottom: 1px solid #666;
        padding-bottom: calc(5 * var(--rpx-vw));
    }

    .match-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: calc(10 * var(--rpx-vw));
        background-color: #383838;
        border-radius: calc(6 * var(--rpx-vw));
        margin-bottom: calc(10 * var(--rpx-vw));
    }

    .match-info {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: calc(8 * var(--rpx-vw)); /* 요소 간의 간격 조절 */
    }

    .match-info > span {
        padding: calc(4 * var(--rpx-vw)) calc(4 * var(--rpx-vw)) calc(1 * var(--rpx-vw)) calc(4 * var(--rpx-vw));
    }

    .matchTime {
        font-weight: bold;
        color: #ffffff;
        min-width: calc(50 * var(--rpx-vw));
        font-size: calc(16 * var(--rpx-vw));
        padding: calc(4 * var(--rpx-vw)) calc(4 * var(--rpx-vw)) calc(1 * var(--rpx-vw)) calc(4 * var(--rpx-vw));
    }

    .home-label {
        background-color: #cdf256;
        color: #1e1e1e;
        border-radius: calc(3 * var(--rpx-vw));
        font-size: calc(14 * var(--rpx-vw));
        text-align: center;
    }

    .team-name, .my-vs-text {
        font-size: calc(16 * var(--rpx-vw));
        color: #ffffff;
        font-weight: bold;
    }

    .score {
        font-weight: bold;
        font-size: calc(16 * var(--rpx-vw));
    }

    .low-score {
        color: #ffffff;
    }

    .high-score {
        color: #cdf256;
    }

    .no-game {
        font-size: calc(24 * var(--rpx-vw));
        color: black;
        margin: 0 auto;
        text-align: center;
    }
</style>

<body>
<header th:replace="~{common/header-2 :: header-2}"></header>
<div class="main-container-section-1">
    <div class="transparent-black"></div>
    <div class="transparent-flex-container"></div>
    <div class="banners">
        <div class="banner-container">
            <div class="left-rectangle"></div>
            <span class="banner-text">MAKE YOUR<br/>ANALYSIS PERFECT<br/>WITH KICKNALYSIS</span>
        </div>
    </div>
</div>
<div class="main-container-section-2">
    <div class="news-contents">
        <div class="shadow-box">
            <div class="news-box-title">
                <span class="news-box-text">해외 축구 뉴스</span>
            </div>
            <div class="news-box-lists">
                <!-- 네이버 야구 뉴스 링크 -->
                <div class="total-news">
                    <a class="total-news-btn" target="_blank"
                       href="https://sports.news.naver.com/wfootball/news/index?isphoto=N">전체 뉴스 보러 가기</a>
                </div>

                <!-- 뉴스 리스트를 표시할 요소 -->
                <div class="news-list-container">
                    <ul id="news-list"></ul>
                </div>

                <div class="my-loading-spinner" id="loadingSpinner" style="display: none;">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="schedule-contents">
        <div class="shadow-box-1">
            <div class="schedule-box-title">
                <button class="schedule-box-text">오늘 경기 일정</button>
            </div>
            <div class="schedule-box-lists">
                <!-- 경기 일정 및 예측 페이지로 이동 -->
                <div class="total-schedule">
                    <a class="total-schedule-btn"
                       href="../home/gameSchedule">전체 일정 보러 가기</a>
                </div>

                <!-- 게임 스케줄을 표시할 요소 -->
                <div class="gameSchedule-list-container">
                    <ul id="gameSchedule-list"></ul>
                </div>
            </div>
        </div>
    </div>
</div>
<footer th:replace="~{common/footer :: footer}"></footer>

<!--네이버 뉴스 AJAX 요청-->
<script th:inline="javascript">
    $(document).ready(function () {
        $("#loadingSpinner").show();

        function fetchNews() {
            $('#news-list').empty();

            $.ajax({
                url: "/getNews",
                method: "GET",
                success: function (data) {
                    let newsHtml = '';
                    $.each(data, function (index, news) {
                        newsHtml += `
                            <li style="display: flex; align-items: flex-start; margin-bottom: calc(10 * var(--rpx-vh));">
                                ${news.imgUrl ? `
                                    <img src="${news.imgUrl}" alt="${news.title}"
                                        style="
                                            width: calc(120 * var(--rpx-vw));
                                            min-height: calc(90 * var(--rpx-vh));
                                            margin-right: calc(10 * var(--rpx-vw));
                                            object-fit: cover;
                                            object-position: center;
                                        "
                                    />` : ''}
                                <div style="flex-grow: 1;">
                                    <h2 style="margin: 0; font-size: calc(16 * var(--rpx-vw)); font-weight: 700;">
                                        <a href="${news.link}" target="_blank">${news.title}</a>
                                    </h2>
                                    <p style="margin: calc(5 * var(--rpx-vh)) 0; font-size: calc(12 * var(--rpx-vw));">
                                        ${news.desc}
                                    </p>
                                    <span style="font-size: calc(12 * var(--rpx-vw)); color: #578CE1;">
                                        ${news.press}
                                    </span>
                                    <span style="color: #E3E3E3;"> | </span>
                                    <span style="font-size: calc(12 * var(--rpx-vw)); color: gray;">
                                        ${news.time}
                                    </span>
                                </div>
                            </li>
                        `;

                        // 마지막 항목이 아닌 경우에만 <hr> 추가
                        if (index < data.length - 1) {
                            newsHtml += '<hr style="color:#7a9d0b; margin-bottom: calc(10 * var(--rpx-vh));">';
                        }
                    });
                    $('#news-list').html(newsHtml);
                },
                error: function () {
                    $('#news-list').html('<li>뉴스를 불러오는 데 실패했습니다.</li>');
                },
                complete: function () {
                    $("#loadingSpinner").hide();
                }
            });
        }

        fetchNews();
    });
</script>

<!--경기 일정 ajax 요청-->
<script th:inline="javascript">
    $(function () {
        // 현재 날짜 가져오기
        const today = new Date();
        const formattedDate = today.toISOString().split('T')[0]; // 'YYYY-MM-DD' 형식으로 변환

        // 긴 경기 테스트용 코드
        // const formattedDate = '2024-11-11';

        // 오늘 날짜 경기 일정 로드
        loadTodayGameSchedules(formattedDate);

        // 오늘 날짜 경기 일정 로드 함수
        function loadTodayGameSchedules(selectedDate) {
            $.ajax({
                type: "GET",
                url: "/usr/home/gameSchedule/date",
                data: { date: selectedDate },
                success: function (response) {
                    const targetElement = $("#gameSchedule-list");
                    targetElement.empty(); // 기존 내용 초기화

                    if (response && response.schedules && response.schedules.length > 0) {
                        let currentLeague = ""; // 현재 리그 초기화
                        let leagueContainer; // 리그 컨테이너

                        // 각 경기 일정 처리
                        response.schedules.forEach(function (gameSchedule) {
                            // 새로운 리그 블럭 생성
                            if (currentLeague !== gameSchedule.leagueName) {
                                currentLeague = gameSchedule.leagueName;
                                leagueContainer = $(`
                                    <div class="league-container">
                                        <h4 class="league-header">${currentLeague}</h4>
                                        <div class="league-block"></div>
                                    </div>
                                `);
                                targetElement.append(leagueContainer);
                            }

                            // 경기 정보 생성 및 추가
                            let listItem = createMatchItemForMainPage(gameSchedule);
                            leagueContainer.find(".league-block").append(listItem);
                        });
                    } else {
                        // 경기가 없는 경우 메시지 표시
                        targetElement.append(`<div class="no-game">오늘은 경기가 없습니다.</div>`);
                    }
                },
                error: function (xhr) {
                    alert("경기 일정을 불러오는 중 문제가 발생했습니다.");
                }
            });
        }

        // 메인 페이지용 경기 정보를 리스트 아이템으로 생성하는 함수 (승무패 버튼 제거)
        function createMatchItemForMainPage(gameSchedule) {
            let listItem = $(`
                <div class="match-item">
                    <span class="matchTime">${gameSchedule.matchTime}</span>
                    <div class="match-info">
                        <span class="home-label">홈</span>
                        <span class="team-name">${gameSchedule.homeTeam}</span>
            `);

            // 점수 표시
            if (gameSchedule.homeTeamScore !== '' && gameSchedule.awayTeamScore !== '') {
                let homeScoreClass = gameSchedule.homeTeamScore > gameSchedule.awayTeamScore ? 'high-score' : 'low-score';
                let awayScoreClass = gameSchedule.awayTeamScore > gameSchedule.homeTeamScore ? 'high-score' : 'low-score';
                listItem.find('.match-info').append(`<span class="score ${homeScoreClass}">${gameSchedule.homeTeamScore}</span> : <span class="score ${awayScoreClass}">${gameSchedule.awayTeamScore}</span>`);
            } else {
                listItem.find('.match-info').append(`<span class="my-vs-text"> vs </span>`);
            }

            listItem.find('.match-info').append(`<span class="team-name">${gameSchedule.awayTeam}</span></div>`);

            return listItem;
        }
    });
</script>

</body>
</html>