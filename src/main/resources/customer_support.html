<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>고객센터</title>

    <!-- 스타일 -->
    <style>
        /* 기존 스타일 유지 */
        .content-section {
            margin: auto;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .category-title {
            font-size: 1.5rem;
            padding: 12px 24px;
            border-radius: 8px;
            transition: background-color 0.3s;
            color: #333;
        }

        .category-title:hover {
            background-color: #e0e0e0;
        }

        .faq-question {
            margin: 10px 0;
            font-size: 1.5rem;
            font-weight: 600;
            color: #007bff;
            transition: color 0.3s;
        }

        .faq-question:hover {
            color: #0056b3;
        }

        .faq-answer {
            margin-left: 20px;
            font-size: 1.2rem;
            color: #555;
            font-weight: bold;
            line-height: 1.5;
        }
    </style>

    <script>
        // 섹션 표시 함수
        function showSection(section) {
            $('.content-section').hide();
            $('#' + section).show();
            $('.faq-list').slideUp();
            $('.content_answer').slideUp();
        }

        $(document).ready(function () {
            showSection('faq');

            // 카테고리 클릭 시 FAQ 토글
            $('.category-title').on('click', function () {
                const faqList = $(this).next('.faq-list');
                $('.faq-list').not(faqList).addClass('hidden');
                faqList.removeClass('hidden');
                $('.faq-answer').slideUp();
            });

            // 질문 클릭 시 답변 표시/숨기기
            $('.faq-question').on('click', function () {
                $(this).next('.faq-answer').slideToggle();
            });

            // 상담 저장 처리
            $('form').on('submit', function (event) {
                event.preventDefault();

                const title = $('#title').val();
                const content = $('#content').val();

                $.ajax({
                    url: '/submit-consultation',
                    method: 'POST',
                    data: {title: title, content: content},
                    success: function () {
                        alert('상담 저장이 완료되었습니다.');
                        location.reload();
                    },
                    error: function () {
                        alert('상담 저장 중 오류가 발생했습니다.');
                    }
                });
            });
        });

        function showConsultationDetails(id) {
            $('.content_answer').addClass('hidden');
            $('.content_answer' + id).removeClass('hidden');
        }

        function saveAnswer(id) {
            const answer = $('.content_answer' + id + ' input[type="text"]').val();

            $.ajax({
                url: '/save-answer',
                method: 'POST',
                data: {id: id, answer: answer},
                success: function () {
                    alert('답변이 저장되었습니다.');
                    location.reload();
                },
                error: function () {
                    alert('답변 저장 중 오류가 발생했습니다.');
                }
            });
        }
    </script>
</head>
<body>
<div class="container mx-auto p-5 bg-white shadow-lg rounded-lg mt-5">
    <h1 class="text-4xl font-bold text-center mb-5">고객센터</h1>

    <div class="flex justify-center space-x-4 mb-5">
        <button class="btn btn-primary" onclick="showSection('faq')">자주 묻는 질문</button>
        <button class="btn btn-primary" onclick="showSection('consultation')">1:1 상담</button>
        <button class="btn btn-primary" onclick="showSection('history')">상담내역</button>
    </div>

    <div id="faq" class="content-section">
        <h2 class="text-2xl font-bold mb-6">자주 묻는 질문 Q&A</h2>
        <div id="faq-list" class="flex flex-wrap gap-4 mb-4">
            <div th:each="category : ${categories}">
                <div>
                    <h3 class="category-title btn btn-outline" th:data-category-id="${category.id}"
                        th:text="${category.categoryName}">
                    </h3>
                    <div class="faq-list hidden mt-2" th:data-category-id="${category.id}">
                        <div th:each="faq : ${faqs}" th:if="${faq.categoryName == category.categoryName}">
                            <h4 class="faq-question cursor-pointer" th:data-faq-id="${faq.id}"
                                th:text="${faq.question}"></h4>
                            <div class="faq-answer hidden" th:data-faq-id="${faq.id}">
                                <p th:text="${faq.answer}"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="consultation" class="content-section" style="display: none;">
        <h2 class="text-xl font-semibold">1:1 상담</h2>
        <form>
            <div class="mb-4">
                <label for="title" class="block text-sm font-medium">제목:</label>
                <input type="text" class="input input-bordered w-full" id="title" name="title" required>
            </div>
            <div class="mb-4">
                <label for="content" class="block text-sm font-medium">내용:</label>
                <textarea class="textarea textarea-bordered w-full h-80" id="content" name="content"
                          required></textarea>
            </div>
            <button type="submit" class="btn btn-success">저장</button>
        </form>
    </div>

    <div id="history" class="content-section" style="display: none;">
        <h2 class="text-xl font-semibold">상담내역</h2>
        <ul class="space-y-4">
            <div th:each="consultation : ${consultations}">
                <li class="p-4 bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow">
                    <a href="#" th:onclick="'showConsultationDetails(' + ${consultation.id} + ')'"
                       class="text-blue-600 font-bold hover:underline"
                       th:text="${consultation.title}"></a>
                    <div class="hidden" th:class="'content_answer' + ${consultation.id}">
                        <div class="bg-gray-100 p-3 rounded-lg border-l-4 border-blue-500">
                            <span class="text-gray-700 font-semibold">내용:</span>
                            <p class="text-gray-600" th:text="${consultation.content}"></p>
                        </div>
                        <div th:if="${isAdmin}" class="bg-gray-100 p-3 rounded-lg border-l-4 border-green-500 mt-2">
                            <span class="text-gray-700 font-semibold">답변:</span>
                            <input type="text" class="input input-bordered w-full mt-1"
                                   th:value="${consultation.answer}">
                            <button class="btn btn-success mt-2" th:onclick="'saveAnswer(' + ${consultation.id} + ')'">
                                저장
                            </button>
                        </div>
                        <div th:if="${!isAdmin}" class="bg-gray-100 p-3 rounded-lg border-l-4 border-green-500 mt-2">
                            <span class="text-gray-700 font-semibold">답변:</span>
                            <p class="text-gray-600" th:text="${consultation.answer}"></p>
                        </div>
                    </div>
                </li>
            </div>
        </ul>
    </div>
</div>
</body>
</html>
